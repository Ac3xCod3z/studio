

const fs = require('fs');
const path = require('path');
const sharp = require('sharp');

const svgIcon = `
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500">
<path d="M0 0 C15.83302126 14.50052864 15.83302126 14.50052864 18.36108398 22.0847168 C27.80193859 20.06086892 36.73181428 17.8631074 45.62670898 14.0378418 C48.43698698 13.05825918 50.41193353 12.78419888 53.36108398 13.0847168 C55.29858398 14.5222168 55.29858398 14.5222168 56.36108398 17.0847168 C55.12414558 24.84220467 52.34776584 32.08359469 49.62036133 39.41625977 C48.85590614 41.47365203 48.10205709 43.53471438 47.34936523 45.59643555 C43.63892751 55.66795152 43.63892751 55.66795152 41.36108398 59.0847168 C41.82391441 66.4982685 43.81243996 73.66285377 45.54467773 80.86401367 C48.06727978 91.60373067 48.60129222 101.86886609 48.61108398 112.8972168 C48.61175873 113.58246429 48.61243347 114.26771179 48.61312866 114.97372437 C48.59508431 126.55668155 47.87463532 137.75147008 45.36108398 149.0847168 C45.19479492 149.83962402 45.02850586 150.59453125 44.85717773 151.37231445 C38.01029317 181.16260201 21.77320399 206.67259679 0.36108398 228.0847168 C0.60291757 231.06733099 1.19942513 232.84683256 2.88696289 235.33007812 C4.69792151 238.71415332 4.7485167 241.02174914 4.75952148 244.84643555 C4.76338867 246.12969727 4.76725586 247.41295898 4.77124023 248.73510742 C4.76181396 249.72861206 4.76181396 249.72861206 4.75219727 250.7421875 C4.73604634 252.77695937 4.75211653 254.80976956 4.77124023 256.84448242 C4.76737305 258.12387695 4.76350586 259.40327148 4.75952148 260.72143555 C4.7561377 261.89407959 4.75275391 263.06672363 4.74926758 264.27490234 C4.62116699 265.20214111 4.49306641 266.12937988 4.36108398 267.0847168 C1.14950815 269.22576735 0.26995989 269.3422452 -3.42993164 269.37524414 C-4.40103882 269.38800385 -5.372146 269.40076355 -6.37268066 269.41390991 C-7.41960083 269.41613556 -8.466521 269.41836121 -9.54516602 269.4206543 C-10.62141235 269.4273111 -11.69765869 269.4339679 -12.80651855 269.44082642 C-15.08282765 269.45095499 -17.35916644 269.45564337 -19.63549805 269.45532227 C-23.12541305 269.45969986 -26.61406824 269.49603087 -30.10375977 269.53393555 C-32.31339085 269.53980264 -34.52302795 269.54377275 -36.73266602 269.5456543 C-38.30304626 269.56721085 -38.30304626 269.56721085 -39.90515137 269.58920288 C-40.87625854 269.58304962 -41.84736572 269.57689636 -42.84790039 269.57055664 C-43.70266968 269.57340668 -44.55743896 269.57625671 -45.43811035 269.57919312 C-47.63891602 269.0847168 -47.63891602 269.0847168 -49.42663574 267.25747681 C-51.00751117 264.42408673 -50.85653514 262.27646401 -50.63891602 259.0847168 C-51.70625977 259.47143555 -52.77360352 259.8581543 -53.87329102 260.2565918 C-69.73776383 265.85889143 -85.75830809 269.61065821 -102.63891602 270.0847168 C-103.6430957 270.12467773 -104.64727539 270.16463867 -105.68188477 270.20581055 C-125.96129725 270.64275606 -145.61979911 266.97410789 -164.63891602 260.0847168 C-164.83227539 260.65061523 -165.02563477 261.21651367 -165.22485352 261.79956055 C-165.48524414 262.53303711 -165.74563477 263.26651367 -166.01391602 264.0222168 C-166.26915039 264.75311523 -166.52438477 265.48401367 -166.78735352 266.23706055 C-167.63891602 268.0847168 -167.63891602 268.0847168 -169.63891602 269.0847168 C-171.19000855 269.19479175 -172.74564699 269.24379471 -174.30053711 269.26171875 C-175.26849213 269.27455399 -176.23644714 269.28738922 -177.23373413 269.3006134 C-178.80715073 269.3116938 -178.80715073 269.3116938 -180.41235352 269.32299805 C-181.48764313 269.33106979 -182.56293274 269.33914154 -183.67080688 269.34745789 C-185.94889713 269.36130423 -188.22700818 269.37202391 -190.50512695 269.37988281 C-193.99282978 269.39711263 -197.47958906 269.44099677 -200.96704102 269.48510742 C-203.17797153 269.49523258 -205.38891012 269.50374924 -207.59985352 269.51049805 C-208.64474945 269.52800613 -209.68964539 269.54551422 -210.76620483 269.56355286 C-217.89407755 269.54214883 -217.89407755 269.54214883 -221.31591797 267.44067383 C-223.03217878 264.38440573 -223.02891032 262.45714723 -222.84594727 258.96362305 C-222.76570313 257.18955078 -222.76570313 257.18955078 -222.68383789 255.37963867 C-222.60713867 254.14793945 -222.53043945 252.91624023 -222.45141602 251.6472168 C-222.39405273 250.41938477 -222.33668945 249.19155273 -222.27758789 247.92651367 C-222.02223854 242.88267762 -221.74270075 238.02288164 -220.63891602 233.0847168 C-219.64891602 233.0847168 -218.65891602 233.0847168 -217.63891602 233.0847168 C-218.0237605 228.08173852 -220.62795245 225.59044623 -224.01391602 222.2097168 C-252.30286963 192.67365681 -267.32575841 152.77286495 -266.99267578 111.98364258 C-266.60933002 97.40013309 -264.38565204 83.12682206 -260.17724609 69.16040039 C-258.22736024 62.52358573 -259.19888615 58.78211101 -261.89672852 52.5690918 C-264.5994823 46.21402063 -267.1108769 39.80869388 -269.51391602 33.3347168 C-269.92899414 32.26350586 -270.34407227 31.19229492 -270.77172852 30.08862305 C-273.06538302 23.87281934 -274.16237346 19.58689601 -272.63891602 13.0847168 C-266.9303282 12.74279617 -262.89166974 13.79622628 -257.63891602 15.9597168 C-247.4614029 20.39618187 -247.4614029 20.39618187 -236.63891602 21.0847168 C-234.40800842 19.14088753 -234.40800842 19.14088753 -232.57641602 16.3972168 C-228.93260131 11.61935772 -225.09403223 7.3151764 -220.82641602 3.0847168 C-220.27526123 2.53340088 -219.72410645 1.98208496 -219.15625 1.4140625 C-211.73399869 -5.9152832 -211.73399869 -5.9152832 -208.63891602 -5.9152832 C-208.63891602 -6.5752832 -208.63891602 -7.2352832 -208.63891602 -7.9152832 C-207.22460938 -9.11694336 -207.22460938 -9.11694336 -205.22875977 -10.4543457 C-204.49375244 -10.94854004 -203.75874512 -11.44273438 -203.00146484 -11.9519043 C-202.20119873 -12.47606934 -201.40093262 -13.00023438 -200.57641602 -13.5402832 C-199.75874756 -14.07862793 -198.9410791 -14.61697266 -198.09863281 -15.17163086 C-135.78374935 -55.67418741 -55.38368185 -49.49445024 0 0 Z " fill="#D12920" transform="translate(361.638916015625,92.915283203125)"/>
<path d="M0 0 C44.22 0 88.44 0 134 0 C134 64.47986577 134 64.47986577 133.5 91.5 C133.45083913 94.32810848 133.40314716 97.15624119 133.35546875 99.984375 C133.24223474 106.65634777 133.12338274 113.32820725 133 120 C132.01 120 131.02 120 130 120 C130 124.95 130 129.9 130 135 C121.60193567 139.36849983 113.07035626 142.33664172 104 145 C103.26861816 145.2175293 102.53723633 145.43505859 101.78369141 145.65917969 C71.68331755 154.17802565 37.42470596 150.04077607 9 138 C7.35 137.34 5.7 136.68 4 136 C3.67 131.05 3.34 126.1 3 121 C2.01 120.67 1.02 120.34 0 120 C0 80.4 0 40.8 0 0 Z " fill="#F7F4EF" transform="translate(183,206)"/>
<path d="M0 0 C0.69754395 0.42893555 1.39508789 0.85787109 2.11376953 1.29980469 C3.76101639 2.34885186 5.35570764 3.47963757 6.9375 4.625 C6.9375 5.285 6.9375 5.945 6.9375 6.625 C7.63359375 6.84027344 8.3296875 7.05554688 9.046875 7.27734375 C12.69864647 8.97985883 15.31379909 11.4315108 18.1875 14.1875 C18.75742676 14.72616699 19.32735352 15.26483398 19.91455078 15.81982422 C21.06211525 16.90857238 22.20622206 18.00097767 23.34667969 19.09716797 C24.73465913 20.43019059 26.13577545 21.74950774 27.5390625 23.06640625 C32.7377536 28.0596508 37.27222436 33.39049577 40.9375 39.625 C40.9375 40.285 40.9375 40.945 40.9375 41.625 C36.22523736 43.86477915 31.42271208 44.45581054 26.3125 45.1875 C24.61164051 45.4364997 22.91110276 45.68770972 21.2109375 45.94140625 C20.46247559 46.04912354 19.71401367 46.15684082 18.94287109 46.26782227 C16.7406869 46.61006233 16.7406869 46.61006233 13.9375 47.625 C9.66402633 48.3003564 5.37091791 48.82621436 1.07763672 49.35888672 C-0.93729494 49.60943149 -2.95111436 49.86887513 -4.96484375 50.12890625 C-30.46821947 53.29345035 -56.0691265 53.96216644 -81.73461914 53.88574219 C-85.61423424 53.8742982 -89.49357626 53.8811694 -93.3731823 53.89262486 C-120.18175152 53.95967439 -146.4662044 52.06996002 -173.0625 48.625 C-174.55716797 48.43719971 -174.55716797 48.43719971 -176.08203125 48.24560547 C-203.78278173 44.76485914 -203.78278173 44.76485914 -210.0625 41.625 C-208.69543903 35.67048609 -205.51322881 32.42046453 -201.375 28.1875 C-200.77494141 27.55779297 -200.17488281 26.92808594 -199.55664062 26.27929688 C-186.87478531 13.02532779 -186.87478531 13.02532779 -183.0625 10.625 C-182.4025 10.625 -181.7425 10.625 -181.0625 10.625 C-181.0625 9.965 -181.0625 9.305 -181.0625 8.625 C-179.64819336 7.42333984 -179.64819336 7.42333984 -177.65234375 6.0859375 C-176.91733643 5.59174316 -176.1823291 5.09754883 -175.42504883 4.58837891 C-174.62478271 4.06421387 -173.8245166 3.54004883 -173 3 C-172.18233154 2.46165527 -171.36466309 1.92331055 -170.5222168 1.36865234 C-118.3677251 -32.52999485 -52.88515449 -32.60837381 0 0 Z " fill="#F6F2ED" transform="translate(334.0625,76.375)"/>
<path d="M0 0 C4.12488983 3.12514095 7.95545918 6.77729592 9 12 C8.56363636 18.43636364 8.56363636 18.43636364 6 21 C3.34462628 21.56520003 0.70855287 21.73788198 -2 22 C-1.39671875 22.32871094 -0.7934375 22.65742188 -0.171875 22.99609375 C5.10347221 26.1357762 8.29439721 28.80173395 10.40625 34.6484375 C12.22374843 41.84668787 11.19361961 47.19175664 7.62109375 53.69921875 C3.68090612 59.29143686 -1.47614586 62.23162928 -8 64 C-18.64035993 65.0167455 -26.78965868 63.78020776 -35.875 58.25 C-39.84711325 54.04423303 -41.84680883 49.89957045 -42.3125 44.125 C-42 41 -42 41 -41 39 C-37.04 39 -33.08 39 -29 39 C-28.34 40.32 -27.68 41.64 -27 43 C-24.77182742 43.95669041 -24.77182742 43.95669041 -22.1875 44.3125 C-21.33542969 44.47363281 -20.48335938 44.63476562 -19.60546875 44.80078125 C-16.78616609 45.01635012 -14.69584947 44.85589788 -12 44 C-9.70986347 40.5647952 -9.82157027 39.014669 -10 35 C-11.03898437 34.76925781 -12.07796875 34.53851563 -13.1484375 34.30078125 C-32.05038782 29.94961218 -32.05038782 29.94961218 -38.625 23.375 C-40.60391357 18.51766668 -40.76300053 14.17144807 -40 9 C-37.10207839 3.09682636 -32.96483573 -0.41610574 -26.875 -2.75 C-17.56204159 -5.54080376 -8.58578908 -4.55246491 0 0 Z M-19 16 C-19 16.66 -19 17.32 -19 18 C-15.13236554 19.87543354 -15.13236554 19.87543354 -11 19 C-12.18523997 17.39585785 -12.18523997 17.39585785 -14 16 C-16.62570704 15.74930087 -16.62570704 15.74930087 -19 16 Z " fill="#EFEDE9" transform="translate(339,380)"/>
<path d="M0 0 C4.12488983 3.12514095 7.95545918 6.77729592 9 12 C8.56363636 18.43636364 8.56363636 18.43636364 6 21 C3.34462628 21.56520003 0.70855287 21.73788198 -2 22 C-1.39671875 22.32871094 -0.7934375 22.65742188 -0.171875 22.99609375 C5.10347221 26.1357762 8.29439721 28.80173395 10.40625 34.6484375 C12.22374843 41.84668787 11.19361961 47.19175664 7.62109375 53.69921875 C3.68090612 59.29143686 -1.47614586 62.23162928 -8 64 C-18.64035993 65.0167455 -26.78965868 63.78020776 -35.875 58.25 C-39.84711325 54.04423303 -41.84680883 49.89957045 -42.3125 44.125 C-42 41 -42 41 -41 39 C-37.04 39 -33.08 39 -29 39 C-28.34 40.32 -27.68 41.64 -27 43 C-24.77182742 43.95669041 -24.77182742 43.95669041 -22.1875 44.3125 C-21.33542969 44.47363281 -20.48335938 44.63476562 -19.60546875 44.80078125 C-16.78616609 45.01635012 -14.69584947 44.85589788 -12 44 C-9.70986347 40.5647952 -9.82157027 39.014669 -10 35 C-11.03898437 34.76925781 -12.07796875 34.53851563 -13.1484375 34.30078125 C-32.05038782 29.94961218 -32.05038782 29.94961218 -38.625 23.375 C-40.60391357 18.51766668 -40.76300053 14.17144807 -40 9 C-37.10207839 3.09682636 -32.96483573 -0.41610574 -26.875 -2.75 C-17.56204159 -5.54080376 -8.58578908 -4.55246491 0 0 Z M-19 16 C-19 16.66 -19 17.32 -19 18 C-15.13236554 19.87543354 -15.13236554 19.87543354 -11 19 C-12.18523997 17.39585785 -12.18523997 17.39585785 -14 16 C-16.62570704 15.74930087 -16.62570704 15.74930087 -19 16 Z M-24 38 C-22.13433512 41.62793998 -22.13433512 41.62793998 -19 44 C-14.85496339 44.24787017 -14.85496339 44.24787017 -11 43 C-11 42.34 -11 41.68 -11 41 C-12.7907985 40.49689942 -14.58266911 39.99761372 -16.375 39.5 C-17.37273437 39.2215625 -18.37046875 38.943125 -19.3984375 38.65625 C-21.87603276 37.91846985 -21.87603276 37.91846985 -24 38 Z " fill="#060606" transform="translate(339,380)"/>
<path d="M0 0 C0.928125 0.20625 1.85625 0.4125 2.8125 0.625 C2.8125 1.615 2.8125 2.605 2.8125 3.625 C-1.6425 2.635 -1.6425 2.635 -6.1875 1.625 C-3.1875 -0.375 -3.1875 -0.375 0 0 Z " fill="#D3D2CE" transform="translate(208.1875,346.375)"/>
<path d="M0 0 C1.32 0.33 2.64 0.66 4 1 C3.67 3.97 3.34 6.94 3 10 C1.19669467 6.39338934 0.53400897 3.91606575 0 0 Z " fill="#EAE7E4" transform="translate(395,234)"/>
</svg>
`;

const publicDir = path.join(__dirname, '..', 'public');
const wellKnownDir = path.join(publicDir, '.well-known');
const iconSource = path.join(__dirname, '..', 'public', 'logo.png');

async function generateIcons() {
  if (!fs.existsSync(iconSource)) {
    console.log(`Icon source not found at ${iconSource}. Using default SVG.`);
    const svgBuffer = Buffer.from(svgIcon);
    for (const size of [192, 512]) {
        const outputPath = path.join(publicDir, `icon-${size}x${size}.png`);
        await sharp(svgBuffer)
            .resize(size, size)
            .png()
            .toFile(outputPath);
        console.log(`Generated icon: ${outputPath}`);
    }
    return;
  }

  // Define icon sizes
  const sizes = [192, 512];

  for (const size of sizes) {
    const outputPath = path.join(publicDir, `icon-${size}x${size}.png`);
    await sharp(iconSource)
      .resize(size, size)
      .png()
      .toFile(outputPath);
    console.log(`Generated icon: ${outputPath}`);
  }
}

function createAssetLinks() {
    if (!fs.existsSync(wellKnownDir)) {
        fs.mkdirSync(wellKnownDir, { recursive: true });
    }
    const assetLinksPath = path.join(wellKnownDir, 'assetlinks.json');
    if (!fs.existsSync(assetLinksPath)) {
        fs.writeFileSync(assetLinksPath, '[]', 'utf-8');
        console.log(`Generated empty assetlinks.json at: ${assetLinksPath}`);
    } else {
        console.log('assetlinks.json already exists.');
    }
}

async function main() {
    if (!fs.existsSync(publicDir)) {
        fs.mkdirSync(publicDir, { recursive: true });
    }
    await generateIcons();
    createAssetLinks();
}

main().catch(err => {
    console.error('Error generating PWA assets:', err);
    process.exit(1);
});

